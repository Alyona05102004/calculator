#include <vcl.h>
#include <System.hpp>
#pragma hdrstop

#include "Unit1.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
using namespace std;
TForm1 *Form1;
float first_num=0.0;   //first number
float second_num=0.0;  //second number
char user_action=' ';   //mathematical action
float res=0.0; //result
UnicodeString full = ""; //full expression
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TForm1::number_click(TObject *Sender)
{
	TButton *button = dynamic_cast<TButton*>(Sender);
	if (Label1->Caption == "0") {
		Label1->Caption = button->Caption;
	} else {
		Label1->Caption += button->Caption;
	}
	full += button->Caption;
}
//---------------------------------------------------------------------------
void __fastcall TForm1::btn_delClick(TObject *Sender)
{
	math_action('/');
}
//---------------------------------------------------------------------------
void __fastcall TForm1::btn_umnojClick(TObject *Sender)
{
	math_action('*');
}
//---------------------------------------------------------------------------
void __fastcall TForm1::btn_subClick(TObject *Sender)
{
	math_action('-');
}
//---------------------------------------------------------------------------
void __fastcall TForm1::btn_sumClick(TObject *Sender)
{
	math_action('+');
}
//---------------------------------------------------------------------------
void __fastcall TForm1::math_action(char action)
{
	if (user_action != ' ') {
		full = full.SubString(1, full.Length() - 1);
	}
	first_num = StrToFloat(Label1->Caption);
	user_action = action;
	full += action;
	Label1->Caption = "0"; // Сбрасываем Label1 для следующего числа
}
//---------------------------------------------------------------------------
void __fastcall TForm1::btn_equalClick(TObject *Sender)
{
	if (user_action == ' ') {
		return;
	}
	second_num = StrToFloat(Label1->Caption);
	switch (user_action) {
		case '+': res = first_num + second_num; break;
		case '-': res = first_num - second_num; break;
		case '*': res = first_num * second_num; break;
		case '/':
			if (second_num != 0.0) {
				res = first_num / second_num;
			} else {
				ShowMessage("На 0 делить нельзя!");
				return;
			}
			break;
	}
	full += Label1->Caption + "=" + FloatToStr(res);
	Label1->Caption = FloatToStr(res); // Отображаем результат
	user_action = ' '; // Сбрасываем действие
}
//---------------------------------------------------------------------------
void __fastcall TForm1::btn_delete_allClick(TObject *Sender)
{
	Label1->Caption = "0";
	first_num = 0.0;
	second_num = 0.0;
	user_action = ' ';
	res = 0.0;
	full = "";
}
//---------------------------------------------------------------------------
void __fastcall TForm1::btn_dotsClick(TObject *Sender)
{
	UnicodeString text = Label1->Caption;
	if (Pos(".", text) == 0) { // Используем точку как десятичный разделитель
		Label1->Caption = text + ".";
		full += ".";
	}
}
//---------------------------------------------------------------------------
